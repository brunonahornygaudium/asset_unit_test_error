name: Qualidade de c√≥digo - App

on: push

jobs:
  passageiro_code_qualiy:
    runs-on: ubuntu-latest
    steps:
      # Clones the project on the machine
      - uses: actions/checkout@v4

      # Installs flutter and related dependency on this machine
      - name: Setup Flutter
        uses: subosito/flutter-action@v2
        with:
          channel: stable
          cache: true
      
      # Prints Flutter version to the console
      - name: Verify Flutter version
        working-directory: ./app
        run: flutter --version
      
      # Get pub dependencies
      - name: Install dependencies
        working-directory: ./app
        run: |
          flutter clean
          flutter pub get

      # Verifies if the dart code is formatted well
      - name: Verify formatting
        working-directory: ./app
        run: dart format --output=none --set-exit-if-changed .

      # Checks for syntactic errors
      - name: Flutter Syntactic Code Analysis
        working-directory: ./app
        run: flutter analyze --fatal-infos 

      # Runs unit test
      - name: Run tests
        run: |
          cd app
          flutter pub get
          flutter test --coverage
